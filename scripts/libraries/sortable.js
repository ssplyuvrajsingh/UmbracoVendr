angular.module("ui.sortable", []).value("uiSortableConfig", { items: "> [ng-repeat],> [data-ng-repeat],> [x-ng-repeat]" }).directive("uiSortable", ["uiSortableConfig", "$timeout", "$log", function (e, t, o) { return { require: "?ngModel", scope: { ngModel: "=", uiSortable: "=", create: "&uiSortableCreate", start: "&uiSortableStart", activate: "&uiSortableActivate", beforeStop: "&uiSortableBeforeStop", update: "&uiSortableUpdate", remove: "&uiSortableRemove", receive: "&uiSortableReceive", deactivate: "&uiSortableDeactivate", stop: "&uiSortableStop" }, link: function (n, r, i, a) { var l, u; function s(e, t) { var o = "function" == typeof t; return "function" == typeof e && o ? function () { e.apply(this, arguments), t.apply(this, arguments) } : o ? t : e } function c(e) { var t = e.data("ui-sortable"); return t && "object" == typeof t && "ui-sortable" === t.widgetFullName ? t : null } function d(t, o) { return h[t] ? ("stop" === t && (o = s(o, function () { n.$apply() }), o = s(o, p)), o = s(h[t], o)) : S[t] && (o = S[t](o)), o || "items" !== t && "ui-model-items" !== t || (o = e.items), o } function f(e, t, o) { angular.forEach(h, function (e, t) { t in v || (v[t] = null) }); var n, r = null; t && angular.forEach(t, function (t, o) { if (!(e && o in e)) { if (o in g) return void (v[o] = "ui-floating" === o ? "auto" : d(o, void 0)); n || (n = angular.element.ui.sortable().options); var i = n[o]; i = d(o, i), r || (r = {}), r[o] = i, v[o] = i } }); return e = angular.extend({}, e), angular.forEach(e, function (t, n) { if (n in g) { if ("ui-floating" !== n || !1 !== t && !0 !== t || !o || (o.floating = t), "ui-preserve-size" === n && (!1 === t || !0 === t)) { var r = v.helper; e.helper = function (e, t) { return !0 === v["ui-preserve-size"] && function (e) { e.children().each(function () { var e = angular.element(this); e.width(e.width()) }) }(t), (r || function (e, t) { return t }).apply(this, arguments) } } v[n] = d(n, t) } }), angular.forEach(e, function (e, t) { t in g || (e = d(t, e), r || (r = {}), r[t] = e, v[t] = e) }), r } function m(e, t) { var o = null; return function (e, t) { var o = e.sortable("option", "helper"); return "clone" === o || "function" == typeof o && t.item.sortable.isCustomHelperUsed() }(e, t) && "parent" === e.sortable("option", "appendTo") && (o = u), o } function p(e, t) { t.item.sortable._destroy() } function b(e) { return e.parent().find(v["ui-model-items"]).index(e) } var v = {}, g = { "ui-floating": void 0, "ui-model-items": e.items, "ui-preserve-size": void 0 }, h = { create: null, start: null, activate: null, beforeStop: null, update: null, remove: null, receive: null, deactivate: null, stop: null }, S = { helper: null }; function y() { n.$watchCollection("ngModel", function () { t(function () { c(r) && r.sortable("refresh") }, 0, !1) }), h.start = function (e, t) { if ("auto" === v["ui-floating"]) { var o = t.item.siblings(); c(angular.element(e.target)).floating = /left|right/.test((n = o).css("float")) || /inline|table-cell/.test(n.css("display")) } var n, i = b(t.item); t.item.sortable = { model: a.$modelValue[i], index: i, source: r, sourceList: t.item.parent(), sourceModel: a.$modelValue, cancel: function () { t.item.sortable._isCanceled = !0 }, isCanceled: function () { return t.item.sortable._isCanceled }, isCustomHelperUsed: function () { return !!t.item.sortable._isCustomHelperUsed }, _isCanceled: !1, _isCustomHelperUsed: t.item.sortable._isCustomHelperUsed, _destroy: function () { angular.forEach(t.item.sortable, function (e, o) { t.item.sortable[o] = void 0 }) }, _connectedSortables: [], _getElementContext: function (e) { return function (e, t) { for (var o = 0; o < e.length; o++) { var n = e[o]; if (n.element[0] === t[0]) return n } }(this._connectedSortables, e) } } }, h.activate = function (e, t) { var o = t.item.sortable.source === r, i = o ? t.item.sortable.sourceList : r, a = { element: r, scope: n, isSourceContext: o, savedNodesOrigin: i }; t.item.sortable._connectedSortables.push(a), l = i.contents(), u = t.helper; var s = function (e) { var t = e.sortable("option", "placeholder"); if (t && t.element && "function" == typeof t.element) { var o = t.element(); return o = angular.element(o) } return null }(r); if (s && s.length) { var c = function (e, t) { var o = v["ui-model-items"].replace(/[^,]*>/g, ""); return e.find('[class="' + t.attr("class") + '"]:not(' + o + ")") }(r, s); l = l.not(c) } }, h.update = function (e, t) { if (!t.item.sortable.received) { t.item.sortable.dropindex = b(t.item); var o = t.item.parent().closest("[ui-sortable], [data-ui-sortable], [x-ui-sortable]"); t.item.sortable.droptarget = o, t.item.sortable.droptargetList = t.item.parent(); var i = t.item.sortable._getElementContext(o); t.item.sortable.droptargetModel = i.scope.ngModel, r.sortable("cancel") } var u = !t.item.sortable.received && m(r, t); u && u.length && (l = l.not(u)); var s = t.item.sortable._getElementContext(r); l.appendTo(s.savedNodesOrigin), t.item.sortable.received && (l = null), t.item.sortable.received && !t.item.sortable.isCanceled() && (n.$apply(function () { a.$modelValue.splice(t.item.sortable.dropindex, 0, t.item.sortable.moved) }), n.$emit("ui-sortable:moved", t)) }, h.stop = function (e, t) { var o = "dropindex" in t.item.sortable && !t.item.sortable.isCanceled(); if (o && !t.item.sortable.received) n.$apply(function () { a.$modelValue.splice(t.item.sortable.dropindex, 0, a.$modelValue.splice(t.item.sortable.index, 1)[0]) }), n.$emit("ui-sortable:moved", t); else if (!o && !angular.equals(r.contents().toArray(), l.toArray())) { var i = m(r, t); i && i.length && (l = l.not(i)); var s = t.item.sortable._getElementContext(r); l.appendTo(s.savedNodesOrigin) } l = null, u = null }, h.receive = function (e, t) { t.item.sortable.received = !0 }, h.remove = function (e, t) { "dropindex" in t.item.sortable || (r.sortable("cancel"), t.item.sortable.cancel()), t.item.sortable.isCanceled() || n.$apply(function () { t.item.sortable.moved = a.$modelValue.splice(t.item.sortable.index, 1)[0] }) }, angular.forEach(h, function (e, t) { h[t] = s(h[t], function () { var e, o = n[t]; "function" == typeof o && ("uiSortable" + t.substring(0, 1).toUpperCase() + t.substring(1)).length && "function" == typeof (e = o()) && e.apply(this, arguments) }) }), S.helper = function (e) { return e && "function" == typeof e ? function (t, o) { var n = o.sortable, i = b(o); o.sortable = { model: a.$modelValue[i], index: i, source: r, sourceList: o.parent(), sourceModel: a.$modelValue, _restore: function () { angular.forEach(o.sortable, function (e, t) { o.sortable[t] = void 0 }), o.sortable = n } }; var l = e.apply(this, arguments); return o.sortable._restore(), o.sortable._isCustomHelperUsed = o !== l, l } : e }, n.$watchCollection("uiSortable", function (e, t) { var o = c(r); if (o) { var n = f(e, t, o); n && r.sortable("option", n) } }, !0), f(v) } function C() { return (!n.uiSortable || !n.uiSortable.disabled) && (a ? y() : o.info("ui.sortable: ngModel not provided!", r), r.sortable(v), C.cancelWatcher(), C.cancelWatcher = angular.noop, !0) } angular.extend(v, g, e, n.uiSortable), angular.element.fn && angular.element.fn.jquery ? (C.cancelWatcher = angular.noop, C() || (C.cancelWatcher = n.$watch("uiSortable.disabled", C))) : o.error("ui.sortable: jQuery should be included before AngularJS!") } } }]);